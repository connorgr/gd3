function mutation_matrix(t){function e(t){t.each(function(e){function n(t,e,n,r,a){function i(t,e){if(t.snid in s){var n=s[t.snid].genes.map(function(t){return t.gene});e.genes.forEach(function(e){-1==n.indexOf(e.gene)&&s[t.snid].genes.push(e)})}else s[t.snid]=e}var o={},s={};Te={},ze={},Ee={},He={},n.forEach(function(t){ze[t]=0,He[t]={}}),r.forEach(function(t){Ee[t.snid]=Number.POSITIVE_INFINITY}),r.forEach(function(r){var s={_id:r._id,name:r.name,snid:r.snid,genes:[],dataset:a[r._id]};if(!T[a[r._id]])return s.cooccurring=!1,void i(r,s);var l=[];n.forEach(function(n){var i=[];if(-1!=e[n].indexOf(r._id)&&(mutated=!1,t[n][r._id].filter(function(t){return _[t]}).sort(function(t,e){return xe[t]<xe[e]?1:-1}).forEach(function(t){s.genes.push({gene:n,dataset:a[r._id],ty:t,sample:r}),mutated=!0,i.push(t),-1==l.indexOf(n)&&l.push(n)}),mutated)){ze[n]+=1,o[r.snid]=!0,Ee[r.snid]=d3.min([Ee[r.snid],me[n]]);var c=d3.min(i.map(function(t){return xe[t]}));He[n][r.snid]=d3.min([c,He[n][r.snid]])}}),s.cooccurring=Te[r.snid]=l.length>1,s.genes.forEach(function(t){t.cooccurring=s.cooccurring}),i(r,s)});var l=[];Object.keys(s).forEach(function(t){l.push(s[t])});var c=Object.keys(o).length;return{sampleMutations:l,coverage:c,geneToFreq:ze,sampleToExclusivity:Te,sampleToGeneIndex:Ee,geneToSampleMutationType:He}}function r(t,e,n,r){function a(t,e){return d3.ascending(n[t.snid],n[e.snid])}function i(t,e){return d3.ascending(r[t.snid],r[e.snid])}function o(t,r){var a=n[G(t)],i=n[G(r)];return a<e.length&&(mut_type1=He[e[a]][t.snid]),i<e.length&&(mut_type2=He[e[i]][r.snid]),mut_type1>mut_type2?1:mut_type1==mut_type2?0:-1}function s(t,e){return d3.ascending(t.name,e.name)}function l(t,e){return d3.ascending(J[t._id],J[e._id])}var c={};return c[_e]=i,c[Se]=a,c[we]=o,c[ke]=s,c[be]=l,d3.range(0,re).sort(function(e,n){var r,a=ne[e],i=ne[n];for(k=0;k<t.length;k++)if(r=c[t[k]](a,i),0!=r)return r;return r})}function p(){mutationData=n(U,ye,te,Z,J),Me=mutationData.sampleMutations,Ee=mutationData.sampleToGeneIndex,Te=mutationData.sampleToExclusivity,ze=mutationData.geneToFreq,Fe=mutationData.coverage,He=mutationData.geneToSampleMutationType;var t=r(Oe,ve,Ee,Te);Ae={};for(var e=0;re>e;e++)Ae[ne[t[e]].snid]=e}function w(t){return"del"==t}function D(t){return"amp"==t}function L(t){return"snv"==t}function j(t){return"other"==t}function N(t){return"inactive_snv"==t}function W(t){return"fus"==t}function G(t){return I?t._id:t.name}function P(){function t(t){return De(Ae[t])>=y+l&&De(Ae[t])<=de}function e(e){return t(e.sample.snid)&&_[e.ty]&&T[J[e.sample._id]]}var n=Re.filter(function(e){return t(e.snid)}).style("fill-opacity",1).style("stroke-opacity",1);Re.filter(function(e){return!t(e.snid)}).style("fill-opacity",.25).style("stroke-opacity",1),Be.style("opacity",0).style("stroke-opacity",0),Be.filter(function(t){return e(t)}).style("opacity",1).style("stroke-opacity",1),Be.filter(function(t){return!e(t)&&_[t.ty]&&T[J[t.sample._id]]}).style("opacity",.25).style("stroke-opacity",.25);var r=n[0].length,a=de-y-l;for(oe=1;4>oe*a/r;)oe+=1;ie=a/r,Xe.attr("width",ie).attr("y",function(t){var e=me[t.gene]?me[t.gene]:0;return(e+.375)*g}),$e.attr("transform",function(t){var e=ie/2,n=(me[t.gene]?me[t.gene]:0)*g+g/2,r=ie/6,a="translate("+e+","+n+")",i="rotate(90)",o="scale("+r+")";return a+","+i+","+o}),Ve.attr("x2",ie).attr("transform",function(t){var e=(me[t.gene]?me[t.gene]:0)*g;return"translate(0,"+e+")"}),We.attr("transform",function(t){return"translate("+De(Ae[G(t)])+")"}),We.selectAll("text").style("font-size",8>ie?ie:8).attr("transform","translate("+ie/2+","+h+"), rotate(-90)"),C.attr("width",ie).attr("height",function(t){return w(t.ty)||D(t.ty)?g/2:g}).attr("y",function(t){var e=me[t.gene]?me[t.gene]:0,n=w(t.ty)?g/2:0;return t.y=e*g+n}),d3.select("rect#sampleWidthRect").attr("width",oe*ie-2*x);var i=1==oe?"sample":"samples";d3.select("text#sampleWidthText").attr("transform","translate("+(ie+5)+",0)").text(oe+" "+i),Ie.selectAll(".vert-line").remove();var o=We.data().map(function(t,e){return e}).filter(function(t){return De(t)>=y+l&&De(t)<=de}).filter(function(t,e){return e%oe==0});Ie.selectAll(".vert-line").data(o).enter().append("line").attr("x1",-ue).attr("y1",l).attr("y2",l).attr("class","vert-line").attr("transform",function(t){return"translate("+De(t)+","+(h+l)+"), rotate(-90)"}).style("stroke","#fff").style("stroke-width",x)}function R(){return(100*Fe/fe).toFixed(2)+"% ("+Fe+"/"+fe+")"}function B(){var e=t.append("span").style("float","right").style("margin-right",(z?le-Ze:0)+"px");e.append("b").text("Coverage: "),Qe=e.append("span").text(R())}function X(t,e){var n=T[e],r=n?.5:1;d3.select(t).selectAll("*").style("fill-opacity",r).style("stroke-opacity",r),T[e]=!n,S()}function V(){if(se){var e=15,n=t.insert("svg","svg").attr("id","sample-type-legend").attr("width",le-Ze).attr("height",ce).style("float","right").style("margin-top",h+l).style("margin-left",Ze).style("margin-bottom",10).style("font-size",10);n.append("text").attr("x",2).attr("y",10).style("font-weight","bold").text("Sample Types");var r=n.selectAll(".dataset-legend").data(K).enter().append("g").attr("transform",function(t,n){return"translate(2,"+(n+1)*e+")"}).style("cursor","pointer").on("click",function(t){X(this,t)});r.append("rect").attr("width",e).attr("height",e).style("fill",function(t){return b[t]}),r.append("text").attr("dy",e-3).attr("dx",20).text(function(t){return t})}}function q(){function e(t,e){var n=_[e],r=n?.5:1;d3.select(t).selectAll("*").style("fill-opacity",r).style("stroke-opacity",r),_[e]=!n,S()}var n=10,r=11,a=n/2,s=t.append("svg").attr("id","mutation-legend").attr("height",v).attr("width",de).style("margin-left",y+l).append("g").style("font-size",r);se||(s.append("rect").attr("x",a).attr("height",g).attr("width",n).style("fill",u),s.append("text").attr("x",n+10).attr("y",3*g/4).style("fill","#000").text("Exclusive"),a+=n+10+65,s.append("rect").attr("x",a).attr("height",g).attr("width",n).style("fill",d),s.append("text").attr("x",a+n+10).attr("y",3*g/4).style("fill","#000").text("Co-occurring"),a+=n+10+85);var c=s.append("g").attr("transform","translate("+a+",0)").style("cursor","pointer").on("click",function(){e(this,"snv")});a+=n+10+10+25;var f=s.append("g").attr("transform","translate("+a+",0)").style("cursor","pointer").on("click",function(){e(this,"inactive_snv")});a+=n+10+75;var p=s.append("g").attr("transform","translate("+a+",0)").style("cursor","pointer").on("click",function(){e(this,"del")});a+=n+10+55;var h=s.append("g").attr("transform","translate("+a+",0)").style("cursor","pointer").on("click",function(){e(this,"amp")});a+=n+10+75;var m=s.append("g").attr("transform","translate("+a+",0)").style("cursor","pointer").on("click",function(){e(this,"fus")});a+=n+10+220,c.append("rect").attr("height",g).attr("width",n).style("fill",o),c.append("text").attr("dx",n+10).attr("dy",3*g/4).style("fill","#000").text("SNV"),f.append("rect").attr("height",g).attr("width",n).style("fill",o),f.append("rect").attr("y",3*g/8).attr("height",g/4).attr("width",n).style("fill","#000"),f.append("text").attr("dx",n+10).attr("dy",3*g/4).style("fill","#000").text("Inactivating"),p.append("rect").attr("y",g/2).attr("height",g/2).attr("width",n).style("fill",o),p.append("text").attr("dx",n+5).attr("dy",3*g/4).style("fill","#000").text("Deletion"),h.append("rect").attr("height",g/2).attr("width",n).style("fill",o),h.append("text").attr("dx",n+10).attr("dy",3*g/4).style("fill","#000").text("Amplification"),m.append("path").attr("d",d3.svg.symbol().type("triangle-up").size(30)).attr("transform","translate(0,"+3*g/8+")rotate(90)").style("stroke",i).style("fill",o),m.append("text").attr("dx",n+10).attr("dy",3*g/4).style("fill","#000").text("Fusion/Rearrangement/Splice Variant"),s.append("rect").attr("x",a).attr("id","sampleWidthRect").attr("width",oe*ie-2*x).attr("height",g).style("fill",o),s.append("text").attr("id","sampleWidthText").attr("x",a).attr("y",3*g/4).attr("transform","translate("+(ie+5)+",0)").style("fill","#000").text(1==oe?"1 sample":oe+" samples")}function Y(){function e(t){for(var e=r(t,ve,Ee,Te),n=0;re>n;n++)Ae[ne[e[n]].snid]=n;We.transition().duration(a).delay(function(t){return De(Ae[t.snid])}).attr("transform",function(t){return"translate("+De(Ae[t.snid])+",0)"}),i()}function n(t,n){var r=Oe,a=Oe.indexOf(t),i=a-n;-1!=i&&i<Oe.length&&(r[a]=r[i],r[i]=t),e(r)}function i(){l.selectAll("*").remove();var t=l.selectAll(".sort-fn").data(Oe).enter().append("li").style("list-style-type","none").style("margin-bottom","5px");t.append("span").style("cursor","pointer").html("&darr;").on("mouseover",function(){d3.select(this).style("color","red")}).on("mouseout",function(){d3.select(this).style("color","black")}).on("click",function(t){n(t,-1)}),t.append("span").style("cursor","pointer").html("&uarr;").on("mouseover",function(){d3.select(this).style("color","red")}).on("mouseout",function(){d3.select(this).style("color","black")}).on("click",function(t){n(t,1)}),t.append("span").text(function(t){Ce[t];return" "+Ce[t]})}var o=t.append("div").attr("id","sample-sorting-interface").style("margin-left",y+"px").style("font-size","12px"),s=o.append("a").style("font-weight","bold").text("Sort mutation matrix by: ").on("click",function(){$("ul#sample-sort-list").is(":visible")?($("ul#sample-sort-list").slideUp(),$("span#interface-status").html("&uarr;")):($("ul#sample-sort-list").slideDown(),$("span#interface-status").html("&darr;"))});s.append("span").attr("id","interface-status").style("cursor","pointer").html("&uarr;");var l=o.append("ul").attr("id","sample-sort-list").style("padding-left","10px").style("display","none");i()}{var U=e.M||{},J=e.sampleToTypes||{},K=e.sampleTypes||[],Q=e.typeToSamples||{},Z=e.samples,te=Object.keys(U);te.length}Z||(Z=Object.keys(J).map(function(t){return{_id:t,name:t,z_index:1}})),Z.forEach(function(t){t.snid=I?t._id:t.name});var ee={};Z.sort(function(t,e){return d3.ascending(t.z_index,e.z_index)}),Z.forEach(function(t){ee[t.snid]||(ee[t.snid]=t)});var ne=[];Object.keys(ee).forEach(function(t){ne.push(ee[t])});for(var re=ne.length,ae=0;ae<Z.length;ae++)-1==K.indexOf(J[Z[ae]._id])&&K.push(J[Z[ae]._id]);K.sort(),K.forEach(function(t){T[t]=!0});var ie,oe,se=K.length>1&&c,le=se?100:0,ce=se?15*(K.length+1):0,de=f-(z?le:0),ue=te.length*g+l;if(I)var fe=K.reduce(function(t,e){return t+Q[e].length},0);else{var pe={};K.forEach(function(t){Q[t].forEach(function(t){pe[t]=!0})});var fe=Object.keys(pe).length}var ge=K.reduce(function(t,e){return b[e]?t+1:t},0);if(ge!=K.length)for(var he=d3.scale.category20(),ae=0;ae<K.length;ae++)b[K[ae]]||(b[K[ae]]=he(ae));var ye={};for(ae=0;ae<te.length;ae++)ye[te[ae]]=Object.keys(U[te[ae]]);var me={},ve=te.sort(function(t,e){return ye[t].length<ye[e].length?1:-1});d3.range(0,te.length).forEach(function(t){me[ve[t]]=t});var xe={fus:0,inactive_snv:1,snv:2,amp:3,del:4,other:5},be=0,ke=1,we=2,_e=3,Se=4,Ce={};Ce[_e]="Exclusivity",Ce[Se]="Gene frequency",Ce[we]="Mutation type",Ce[ke]="Sample name",Ce[be]="Sample type";var Me,Ee,Te,Ae,ze,He,Fe,Oe=[Se,be,_e,we,ke];p();var Ie=d3.select(this).selectAll("svg").data([e]).enter().append("svg"),De=d3.scale.linear().domain([0,re]).range([y+l,de-l]),Le=d3.behavior.zoom().x(De).scaleExtent([1,Math.round(m*re/de)]).on("zoom",function(){P()});Ie.attr("id","mutation-matrix").attr("width",de).attr("height",ue+h).attr("xmlns","http://www.w3.org/2000/svg").call(Le);var je=Ie.append("g").attr("transform","translate("+l+","+l+")");je.append("rect").style("fill",i).attr("width",de-y-l).attr("height",ue).attr("transform","translate("+(y+l)+","+h+")");var Ne=je.append("svg:g").attr("id","mutation-matrix"),We=Ne.selectAll(".sample").data(Me).enter().append("svg:g").attr("class","sample").attr("id",function(t){return t.name});We.append("text").attr("fill",o).attr("text-anchor","start").text(function(t){return t.name});var Ge=je.selectAll(".geneLabels").data(te).enter().append("svg:g").attr("class","geneLabel").attr("transform",function(t){return"translate(0,"+(h+me[t]*g)+")"}),Pe=Ge.append("text").attr("class","gene-name").attr("font-size",14).attr("text-anchor","end").attr("transform",function(){return"translate("+y+","+(g-l)+")"}).text(function(t){return t+" ("+ze[t]+")"});je.selectAll(".horizontal-line").data(te).enter().append("line").attr("x2",de-y).attr("transform",function(t,e){var n=y+l,r=h+e*g;return"translate("+n+","+r+")"}).style("stroke","#fff");var Re=We.append("g").attr("transform","translate(0,"+h+")"),Be=Re.selectAll(".muts").data(function(t){return t.genes}).enter().append("g");C=Be.append("rect").attr("class",function(t){return"tick "+t.ty}).attr("fill",function(t){return se?W(t.ty)&&L(t.ty)?i:b[t.dataset]:W(t.ty)&&L(t.ty)?i:t.cooccurring?d:u});var Xe=Be.append("rect").filter(function(t){return N(t.ty)}).attr("class","inactivating").attr("width",ie).attr("height",g/4).style("fill",s),$e=Be.append("svg:path").filter(function(t){return W(t.ty)}).attr("class","fusion").attr("d",d3.svg.symbol().type("triangle-up").size(8)).style("stroke-opacity",0).style("fill",function(t){return se?b[t.dataset]:t.cooccurring?d:u}),Ve=Be.append("line").filter(function(t){return j(t.ty)}).attr("class","other").attr("x1",function(){return 0}).attr("y1",function(){return 0}).attr("y2",function(){return g}).style("stroke","#000").style("stroke-width",2);if(O){E=d3.tip().attr("class","d3-tip").offset([-10,0]).html(M),Ie.call(E);var qe="div.m2-tooltip",Ye=function(t,e){d3.select(qe+" div.more-info").style("display",t?"inline":"none"),d3.select(qe+" div.less-info").style("display",e?"inline":"none")},Ue=function(t){E.hide(t),d3.select(this).on("mouseout",function(){E.hide(t)}),Ye(!1,!0)},Je=function(t){E.show(t),d3.select(qe).insert("span",":first-child").style("cursor","pointer").style("float","right").attr("class","x").on("click",Ue).text("X")},Ke=function(t){Je(t),Ye(!0,!1)};Be.on("mouseover",Je).on("mouseout",E.hide).on("click",function(t){Ke(t),d3.select(this).on("mouseout",Ke)})}var Qe,Ze=10;S=function(){p(),Pe.text(function(t){return t+" ("+ze[t]+")"}),Qe.text(R()),P()},P(),A&&B(),z&&V(),H&&q(),F&&Y()})}var t=t||{},n=t.style||{},r=n.colorSchemes||{},a=n.animationSpeed||300,i=n.bgColor||"#F6F6F6",o=n.blockColorMedium||"#95A5A6",s=n.blockColorStrongest||"#2C3E50",l=n.boxMargin||5,c=n.colorSampleTypes||!0,d=n.coocurringColor||"orange",u=n.exclusiveColor||"blue",f=n.width||500,p=n.height||300,g=n.geneHeight||20,h=n.labelHeight||40,y=n.labelWidth||100,m=n.minBoxWidth||20,v=n.mutationLegendHeight||30,x=n.sampleStroke||1,b=r.sampleType||{},w=t.mutationTypes||["snv","inactive_snv","del","amp","fus","other"],_={};w.forEach(function(t){_[t]=!0});var S,C,M,E,T={},A=!1,z=!1,H=!1,F=!1,O=!1,I=!1;return e.addCoverage=function(){return A=!0,e},e.addSampleLegend=function(){return z=!0,e},e.addMutationLegend=function(){return H=!0,e},e.addSortingMenu=function(){return F=!0,e},e.showDuplicates=function(){return I=!0,e},e.width=function(t){return arguments.length?(f=t,e):width},e.height=function(t){return arguments.length?(p=t,e):height},e.filterDatasets=function(t){Object.keys(t).forEach(function(e){T[e]=t[e]}),S()},e.addTooltips=function(t){return O=!0,M=t,C&&E&&E.html(t),e},e}function transcript_plot(t){function e(t){t.each(function(e){function n(){var n=Object.keys(y),r=n.length,a=Math.ceil(r/2),i=a*legendSymbolHeight,s=t.append("div").selectAll("svg").data([e]).enter().append("svg").attr("class","legend").attr("font-size",10).style("height",i+2*margin).style("width",width),l=s.selectAll(".symbolGroup").data(n).enter().append("g").attr("transform",function(t,e){var n=e%a*width/a+2*margin,i=Math.round(e/r)*legendSymbolHeight+(Math.round(e/r)+2)*margin;return"translate("+n+", "+i+")"}).style("cursor","pointer").on("click",function(t){var e=m[t],n=e?.5:1;d3.select(this).selectAll("*").style("fill-opacity",n).style("stroke-opacity",n),m[t]=!e,v()});l.append("path").attr("class","symbol").attr("d",d3.svg.symbol().type(function(t){return d3.svg.symbolTypes[y[t]]}).size(2*legendSymbolHeight)).style("stroke",o).style("stroke-width",2).style("fill",o),l.append("text").attr("dx",7).attr("dy",3).text(function(t){return t.replace(/_/g," ")})}function r(){function t(t,e,n){t.attr("cy",e.y=n),e.z.translate([e.z.translate()[0],"up"==e.direction?e.scale(e.y):-e.scale(e.y)]),v()}function e(t,e){return"up"==t.direction?Math.max(t.y2,Math.min(t.y1,e)):Math.max(t.y1,Math.min(t.y2,e))}function n(n){d3.select(this).attr("opacity",.6),t(d3.select(this),n,e(n,d3.event.y))}function r(){d3.select(this).attr("opacity",1)}var a=5,i=8,o=5,s=4,l=A-2*i-2*margin;sliderRadius=4,sliderWidth=3,sliderMargin=margin+i;var c=[{x:margin,y1:sliderMargin+l,y2:sliderMargin,direction:"up",z:R,scale:P,name:"topSlider"},{x:margin,y1:height-sliderMargin-l,y2:height-sliderMargin,direction:"down",z:$,scale:X,name:"bottomSlider"}];c.forEach(function(t){t.y=t.y1,t.scale.domain([t.y1,t.y2])});var u=[{y:margin,increment:-a,symbol:o,slider:c[0]},{y:sliderMargin+2*margin+l,increment:a,symbol:s,slider:c[0]},{y:height-l-sliderMargin-2*margin,increment:-a,symbol:o,slider:c[1]},{y:height-margin,increment:a,symbol:s,scale:X,slider:c[1]}];z.selectAll(".button").data(u).enter().append("path").attr("d",d3.svg.symbol().type(function(t){return d3.svg.symbolTypes[t.symbol]}).size(radius*radius)).attr("transform",function(t){return"translate("+margin+","+t.y+")"}).style("cursor","pointer").style("fill",d).on("click",function(n){var r=e(n.slider,n.slider.y+n.increment);t(d3.select("circle#"+n.slider.name),n.slider,r)});var f=d3.behavior.drag().origin(Object).on("drag",n).on("dragend",r),p=z.selectAll(".slider").data(c).enter().append("g");p.append("line").attr("x1",function(t){return t.x}).attr("x2",function(t){return t.x}).attr("y1",function(t){return t.y1}).attr("y2",function(t){return t.y2}).style("stroke","#C0C0C0").style("stroke-width",2),p.append("circle").attr("id",function(t){return t.name}).attr("r",sliderRadius).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y1}).attr("fill","#C0C0C0").style("cursor","pointer").call(f)}var k=e.gene,w=e.length,_=e.mutations,S=e.domains[a]||[],C=_.slice(),M=[];if(_.forEach(function(t){-1==M.indexOf(t.dataset)&&M.push(t.dataset)}),M.sort(),M.forEach(function(t){b[t]=!0}),0==Object.keys(x).length)for(var E=d3.scale.category20(),T=0;T<M.length;T++)x[M[T]]=E(T);var A=(height-genomeHeight-axisHeight-4*margin)/2,z=d3.select(this).selectAll("svg").data([e]).enter().append("svg").style("cursor","move");z.attr("class","transcript-box").attr("id",k+"-transcript").attr("width",width).attr("height",height+2*margin);var H=z.append("g"),F=(H.append("rect").attr("class","background").attr("width",width).attr("height",height).style("fill",c),A),O=(H.append("rect").attr("class","background").attr("id","background-top").attr("width",width-2*margin).attr("height",A).attr("x",margin).attr("y",margin).style("fill",c),A+genomeHeight+axisHeight+3.5*margin),I=(H.append("rect").attr("class","background").attr("id","background-bottom").attr("width",width-2*margin).attr("height",A).attr("x",margin).attr("y",A+genomeHeight+axisHeight+3*margin).style("fill",c),0),D=w,L=d3.scale.linear().domain([I,D]).range([margin,width-margin]),j=d3.behavior.zoom().x(L).scaleExtent([1,100]).on("zoom",function(){v()});H.call(j);var N=2*radius,W=_.length,G=d3.scale.linear().domain([0,W]).range([A,-1*N*W+F]),P=d3.scale.linear().range([0,N*W]),R=d3.behavior.zoom().y(G).scaleExtent([1,1]).on("zoom",function(){v()}),B=d3.scale.linear().domain([0,W]).range([O,O+W*N]),X=d3.scale.linear().range([0,N*W]),$=d3.behavior.zoom().y(B).scaleExtent([1,1]).on("zoom",function(){v()}),V=2*margin+A,q=H.append("rect").attr("class","transcript").attr("height",genomeHeight-margin).attr("width",L(D)-L(I)).attr("x",L(I)).attr("y",V+margin/2).style("fill",i),Y=d3.svg.axis().scale(L).orient("bottom").ticks(numTicks).tickSize(0).tickPadding(tickPadding),U=H.append("g").attr("class","xaxis").attr("transform","translate(5,"+(V+genomeHeight+margin)+")").style("font-size","12px").style("fill","#000").call(Y),J=H.selectAll(".top-symbols").data(C.filter(function(t){return!h[t.ty]})).enter().append("path").attr("class","symbols").attr("d",d3.svg.symbol().type(function(t){return d3.svg.symbolTypes[y[t.ty]]}).size(radius*radius)).style("fill",function(t){return x[t.dataset]}).style("stroke",function(t){return x[t.dataset]}).style("stroke-width",2).style("cursor","default"),K=H.selectAll(".bottom-symbols").data(C.filter(function(t){return h[t.ty]})).enter().append("path").attr("class","symbols").attr("d",d3.svg.symbol().type(function(t){return d3.svg.symbolTypes[y[t.ty]]}).size(radius*radius)).style("fill",function(t){return x[t.dataset]}).style("stroke",function(t){return x[t.dataset]}).style("stroke-width",2).style("cursor","default");if(g){var Q=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return t.sample+"<br />Type: "+t.dataset+"<br/>"+t.ty.replace(/_/g," ")+"<br />"+t.locus+": "+t.aao+">"+t.aan});z.call(Q),K.on("mouseover",Q.show).on("mouseout",Q.hide),J.on("mouseover",Q.show).on("mouseout",Q.hide)}var Z=H.selectAll(".domains").data(S.slice()).enter().append("g").attr("class","domains"),te=Z.append("rect").attr("id",function(t,e){return"domain-"+e}).attr("width",function(t){return L(t.end)-L(t.start)}).attr("height",genomeHeight+margin).style("fill",o).style("fill-opacity",.5),ee=Z.append("text").attr("id",function(t,e){return"domain-label-"+e}).attr("text-anchor","middle").attr("y",genomeHeight).style("fill",l).style("fill-opacity",0).text(function(t){return t.name});Z.on("mouseover",function(t,e){d3.select(this).selectAll("rect").style("fill",s),H.select("#domain-label-"+e).style("fill-opacity",1)}).on("mouseout",function(t,e){d3.select(this).selectAll("rect").style("fill",o),H.select("#domain-label-"+e).style("fill-opacity",0)}),v=function(){function t(t,e,n,r,s){var l={};t.filter(function(t){return m[t.ty]&&b[t.dataset]}).each(function(t){var e=Math.round(t.locus/o);e in l?(yIndex=l[e],l[e]+=1):(yIndex=0,l[e]=1),t.x=L(e*o),t.y=n(yIndex)}),W=d3.max(Object.keys(l),function(t){return l[t]}),e.range([0,N*W]),t.attr("transform",function(t){return"translate("+t.x+", "+t.y+")"}).style("fill-opacity",1).style("stroke-opacity",1),t.filter(function(t){var e=r<t.y&&s>t.y&&a<t.locus&&i>t.locus,n=m[t.ty],o=b[t.dataset];return!(e&&n&&o)}).style("fill-opacity",0).style("stroke-opacity",0)}var e=j.translate(),n=(j.scale(),e[0]),r=e[1];n=Math.min(n,0),j.translate([n,r]);var a=d3.min(L.domain()),i=d3.max(L.domain()),o=Math.round((i-a)/u);o=o?o:1,t(J,P,G,0,A+margin),t(K,X,B,O-margin,height-2*margin),U.call(Y),q.attr("x",L(I)).attr("width",L(D)-L(I)),Z.attr("transform",function(t){return"translate("+L(t.start)+","+(V-margin/2)+")"}),te.attr("width",function(t){return L(t.end)-L(t.start)}),ee.attr("x",function(){var t=d3.select(this.parentNode).select("rect").attr("width");return t/2})},v(),f&&n(),p&&r()})}var t=t||{},n=t.style||{},r=n.colorSchemes||{},a=t.domainDB||"PFAM",i=n.blockColorLight||"#BDC3C7",o=n.blockColorMedium||"#95A5A6",s=n.highlightColor||"#f1c40f",l=n.textColorStrongest||"#2C3E50",c=n.bgColor||"#ffffff",d=n.buttonColor||"#666666";genomeHeight=n.genomeHeight||20,axisHeight=n.axisHeight||20,height=n.height||200,margin=n.margin||5,numTicks=n.numTicks||5,radius=n.radius||5,legendSymbolHeight=n.legendSymbolHeight||14,tickPadding=n.tickPadding||1.25,width=n.width||500;var u=Math.floor(width/(2*radius)),f=!1,p=!1,g=!1,h=t.inactivating||{Nonsense_Mutation:!0,Frame_Shift_Del:!0,Frame_Shift_Ins:!0,Missense_Mutation:!1,Splice_Site:!0,In_Frame_Del:!1,In_Frame_Ins:!1},y=t.mutSymbols||{Nonsense_Mutation:0,Frame_Shift_Del:1,Frame_Shift_Ins:1,Missense_Mutation:2,Splice_Site:3,In_Frame_Del:4,In_Frame_Ins:4},m={};Object.keys(y).forEach(function(t){m[t]=!0});var v,x=r.sampleType||{},b={};return e.addLegend=function(){return f=!0,e},e.addTooltips=function(){return g=!0,e},e.addVerticalPanning=function(){return p=!0,e},e.filterDatasets=function(t){Object.keys(t).forEach(function(e){b[e]=t[e]}),v()},e}function subnetwork(t){function e(t){t.each(function(t){function e(){var t=k?b-Math.max(u+15,m):b-m,e=M.selectAll(".net-group").data(F).enter().append("g").attr("transform",function(e,n){return"translate("+t+","+(n+1)*y+")"}).style("font-size",12).on("click",function(t){var e=N[t];N[t]=!e,e||j[t].style("display","inline"),j[t].transition().duration(x).style("stroke-opacity",e?0:1),e&&setTimeout(function(){j[t].style("display","none")},x),d3.select(this).transition().duration(x).style("stroke-opacity",e?.5:1).style("fill-opacity",e?.5:1),n&&(L.filter(function(t){return t.networks.reduce(function(t,e){return t+(N[e]?1:0)},0)>0}).on("mouseover",X).on("mouseout",R.hide).on("click",function(t){X(t),d3.select(this).on("mouseout",X)}),L.filter(function(t){return 0==t.networks.reduce(function(t,e){return t+(N[e]?1:0)},0)}).on("mouseover",function(){}).on("mouseout",function(){}))});e.append("line").attr("x1",0).attr("x2",y).style("stroke-width",o).style("stroke",function(t){return a.network[t]}),e.append("text").attr("x",8+y).attr("y",3).text(function(t){return t})}function r(){var t=k?18*F.length+15:10,e=k?b-Math.max(u+15,m):b-u-15,n=M.append("g").attr("id","subnetwork-legend").attr("transform","translate("+e+","+t+")");M.append("svg:defs").append("svg:linearGradient").attr("x1","0%").attr("y1","100%").attr("x2","0%").attr("y2","0%").attr("id","heat_gradient").call(function(t){t.append("svg:stop").attr("offset","0%").attr("style","stop-color:"+i+";stop-opacity:1"),t.append("svg:stop").attr("offset","100%").attr("style","stop-color:"+g+";stop-opacity:1")}),n.append("rect").attr("y",5).attr("width",u).attr("height",d).style("fill","url(#heat_gradient)"),n.append("text").attr("dx",u/2).attr("text-anchor","middle").text(d3.max(E)),n.append("text").attr("dx",u/2).attr("dy",d+20).attr("text-anchor","middle").text(d3.min(E)),n.append("text").attr("dx",(d+10)/2).attr("dy",-u-5).attr("text-anchor","middle").attr("transform","rotate(90)").text(f)}function _(t,e){for(var n=[],r=0;r<e.length;r++)for(var a=e[r].name,i=0;i<e.length;i++)for(var o=e[i].name,s=0;s<t.length;s++){var l=t[s].source,c=t[s].target;(a==l&&o==c||a==c&&o==l)&&n.push({source:e[r],target:e[i],weight:t[s].weight,networks:t[s].networks,references:t[s].references})}return n}var S=t.edges,C=t.nodes,M=d3.select(this).selectAll("svg").data([t]).enter().append("svg");M.attr("id","figure").attr("height",p+h.top+h.bottom).attr("width",b).style("font-family",l).style("font-size",c);var E=C.map(function(t){return t.heat}),T=d3.scale.linear().domain([d3.min(E),d3.max(E)]).range([i,g]).nice(),A=b;k&&w?A-=Math.max(m,u):k?A-=m:w&&(A-=u);var z=d3.layout.force().charge(-400).linkDistance(40).size([A,p]),H=(z.drag().on("dragstart",function(t){t.fixed=!0,d3.select(this).select("circle").style("stroke-opacity",0)}),d3.scale.linear().range([0,A]),d3.scale.linear().range([0,p]),_(S,C));z.nodes(C).links(H).start();for(var F=[],O=0;O<H.length;O++)for(var I=0;I<H[O].networks.length;I++)-1==F.indexOf(H[O].networks[I])&&F.push(H[O].networks[I]);for(var D=F.length,L=M.selectAll(".link").data(H).enter().append("g"),j={},N={},O=0;O<F.length;O++){var W=F[O],G=a.network[F[O]];N[W]=!0;var P=L.filter(function(t){return t.networks&&-1!=t.networks.indexOf(W)}).append("line").classed(W,!0).style("stroke-width",o).style("stroke",G);j[W]=P}if(n){var R=d3.tip().attr("class","d3-tip").offset([-10,10]).html(function(t){function e(t){return"<li><a href='http://www.ncbi.nlm.nih.gov/pubmed/"+t+"' target='_new'>"+t+"</a></li>"}var n="<div id='subnet-tooltip'>\n";return n+="Source: "+t.source.name+"<br/>Target: "+t.target.name+"<br/><br/>",n+="<table class='table table-condensed'>\n<tr><th>Network</th><th>PMIDs</th></tr>\n",t.networks.filter(function(t){return N[t]}).forEach(function(r){var a=t.references[r].map(e).join("\n");n+="<tr><td>"+r+"</td><td><ul style='padding-left:10px'>"+a+"</td></ul></tr>\n"}),n+"</table>\n</div>\n"});M.call(R);var B=function(t){R.hide(t),d3.select(this).on("mouseout",function(){R.hide(t)})},X=function(t){R.show(t),d3.select("div#subnet-tooltip").insert("span",":first-child").style("cursor","pointer").style("float","right").attr("class","x").on("click",B).text("X")};L.on("mouseover",X).on("mouseout",R.hide).on("click",function(t){X(t),d3.select(this).on("mouseout",X)})}var $=M.append("svg:g").selectAll("node").data(C).enter().append("svg:g").style("cursor","move").call(z.drag).on("dblclick",function(t){t.fixed=t.fixed?!1:!0,d3.select(this).select("circle").style("stroke-opacity",1)});$.append("circle").attr("r",v).attr("fill",function(t){return T(t.heat)}).style("stroke-width",1.5).style("stroke","#333"),$.append("text").attr("x",v).attr("y","10px").style("fill",s).style("fill-opacity","1").style("font-size",c).text(function(t){return t.name}),z.on("tick",function(){$.attr("transform",function(t){return t.x=Math.max(v,Math.min(A-v,t.x)),t.y=Math.max(v,Math.min(p-v,t.y)),"translate("+t.x+","+t.y+")"}),F.forEach(function(t,e){var n=o*(e-D/2);j[t].attr("x1",function(t){return t.source.x+n}).attr("y1",function(t){return t.source.y+n}).attr("x2",function(t){return t.target.x+n}).attr("y2",function(t){return t.target.y+n})})}),k&&e(),w&&r()})}var n,t=t||{},r=t.style||{},a=r.colorSchemes||{},i=r.cold||"rgb(102, 178, 255)",o=r.edgeWidth||1.5,s=r.fontColor||"#333",l=r.fontFamily||'"Helvetica","Arial"',c=r.fontSize||12,d=r.heatLegendHeight||110,u=r.heatLegendWidth||50,f=r.heatLegendText||"No. Mutated Samples",p=r.height||350,g=r.hot||"rgb(255, 51, 51)",h=r.margins||{bottom:0,left:0,right:0,top:0},y=r.netLegendBox||15,m=r.netLegendWidth||100,v=r.nodeRadius||10,x=r.transitionTime||500,b=r.width||350,k=!1,w=!1;return void 0==a.network&&(a.network={Multinet:"rgb(92, 128, 178)",iRefIndex:"rgb(140, 91, 56)",HINT:"rgb(127, 92, 159)","HINT+HI2012":"rgb(127, 92, 159)"}),e.addNetworkLegend=function(){return k=!0,e},e.addGradientLegend=function(){return w=!0,e},e.addTooltips=function(){return n=!0,e},e}function cna_browser(t){function e(t){t.each(function(t){function e(){if(genome=R.append("rect").attr("class","genome").attr("y",b+(y-10)/2).attr("x",0).attr("width",h).attr("height",y-10).style("fill",s),geneGroups=R.selectAll(".genes").data(O).enter().append("g").attr("class","genes"),genes=geneGroups.append("rect").attr("width",function(t){return V(t.end)-V(t.start)}).attr("height",y).style("fill-opacity",function(t){return t.selected?1:.2}).style("fill",function(t){return t.selected?c:o}).attr("id",function(t,e){return"gene-"+e}),geneLabels=geneGroups.append("text").attr("id",function(t,e){return"gene-label-"+e}).attr("y",b+5+y/2).attr("text-anchor","middle").style("fill-opacity",function(t){return t.selected?1:0}).style("fill",d).text(function(t){return t.label}),geneGroups.on("mouseover",function(t){t.fixed||(d3.select(this).select("rect").style("fill",l),d3.select(this).select("text").style("fill-opacity",1))}).on("mouseout",function(t){t.fixed||(d3.select(this).select("rect").style("fill",function(t){return t.selected?c:o}),d3.select(this).select("text").style("fill-opacity",0))}).on("dblclick",function(t){t.fixed=t.fixed?!1:!0,t.fixed&&(d3.select(this).select("rect").style("fill",function(t){return t.selected?c:l}),d3.select(this).select("text").style("fill-opacity",1))}),intervals=R.selectAll(".intervals").data(L).enter().append("g").attr("class","intervals"),ints=intervals.append("rect").attr("fill",function(t){return _[C[t.sample]]}).attr("width",function(t){return V(t.end,H,F)-V(t.start,H,F)}).attr("height",5).attr("id",function(t,e){return"interval-"+e}),w){var t=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return t.sample+"<br/>Type: "+C[t.sample]+"<br/>Start: "+t.start+"<br/>End:    "+t.end});R.call(t),intervals.on("mouseover",t.show).on("mouseout",t.hide)}}function r(){genes.attr("transform",function(t){return"translate("+V(t.start)+","+b+")"}),genes.attr("width",function(t){return V(t.end)-V(t.start)}),geneLabels.attr("transform",function(t){d3.max([t.start,d3.max(V.domain())]),d3.min([t.end,d3.min(V.domain())]);return"translate("+V(t.start+(t.end-t.start)/2)+",0)"
})}function a(){ints.attr("transform",function(t){return"translate("+V(t.start)+","+(b-15+t.y)+")"}).attr("width",function(t){return V(t.end)-V(t.start)});intervals.filter(function(t){return S[C[t.sample]]}).style("opacity",1);intervals.filter(function(t){return!S[C[t.sample]]}).style("opacity",0)}for(var C=t.sampleToTypes,M=t.gene,E=t.neighbors,T=t.segments,A=t.region,z=A.chr,H=A.minSegX,F=A.maxSegX,O=E.map(function(t){var e=t.name==M;return{fixed:e?!0:!1,start:t.start,end:t.end,label:t.name,selected:e}}),I=v,D=new Array,L=new Array,j=new Array,N=0;N<T.length;N++){var W=T[N];I+=m,D.push(W.sample);for(var G=0;G<W.segments.length;G++){var P=W.segments[G];L.push({start:P.start,end:P.end,label:P.sample,y:I,sample:W.sample}),j.indexOf(C[W.sample])&&j.push(C[W.sample])}}j.sort(),j.forEach(function(t){S[t]=!0});var R=d3.select(this).selectAll("svg").data([t]).enter().append("svg"),B=A.minSegX,X=A.maxSegX,$=d3.scale.linear().domain([B,X]).range([0,h]),V=(d3.svg.axis().scale($).orient("bottom").ticks(5).tickSize(0).tickPadding(1.25),d3.scale.linear().domain([B,X]).range([0,h])),q=d3.behavior.zoom().x($).scaleExtent([1,100]).on("zoom",function(){n()});R.attr("id","cna-browser").attr("height",p+g.top+g.bottom).attr("width",h).style("display","block").style("font-family",u).style("font-size",f).call(q).on("dblclick.zoom",null);var Y=(R.append("rect").attr("width",h).attr("height",p).attr("class","background").style("fill",i),R.append("text").attr("x",3).attr("y",x).style("font-size",k));n=function(){var t=d3.min($.domain()),e=d3.max($.domain());V.domain([t,e]),Y.text("chr"+z+": "+d3.round(t)+"-"+d3.round(e)),r(t,e),a(t,e)},e(),n()})}var n,t=t||{},r=t.style||{},a=r.colorSchemes||{},i=r.bgColor||"#F6F6F6",o=(r.blockColorStrongest||"#2C3E50",r.blockColorStrong||"#7F8C8D",r.blockColorMedium||"#95A5A6"),s=r.blockColorLight||"#BDC3C7",l=(r.blockColorLightest||"#ECF0F1",r.highlightColor||"#f1c40f"),c=r.selectedColor||"#E74C3C",d=r.textColorStrongest||"#2C3E50",u=(r.textColorStrong||"#34495E",r.textColorLight||"#BDC3C7",r.textColorLightest||"#ECF0F1",r.fontColor||"#333",r.fontFamily||'"Helvetica","Arial"'),f=r.fontSize||10,p=r.height||250,g=r.margins||{bottom:0,left:0,right:0,top:0},h=r.width||800,y=r.genomeHeight||25,m=r.intervalH||7,v=r.initIntervalH||50,x=r.rangeLegendY||15,b=r.rangeLegendOffset||25,k=r.rangeLegendFontSize||11,w=!1,_=a.sampleType||{},S={};return e.width=function(t){return arguments.length?(fullWidth=t,e):h},e.height=function(t){return arguments.length?(fullHeight=t,e):p},e.addTooltips=function(){return w=!0,e},e.filterDatasets=function(t){Object.keys(t).forEach(function(e){S[e]=t[e]}),n()},e}
//# sourceMappingURL=dist/js/gd3.min.js.map